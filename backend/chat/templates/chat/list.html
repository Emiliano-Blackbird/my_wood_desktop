{% extends "general/layout.html" %}
{% block title %}Conversaciones{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="h4 mb-3">Conversaciones</h2>

  <div class="list-group">
    {% for conv in conversations %}
      <a href="{% url 'chat:detail' conv.pk %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-start">
        <div class="me-2">
          <strong>
            {% for p in conv.participants.all %}
              {% if p != request.user %}{{ p.get_full_name|default:p.username }}{% endif %}
            {% endfor %}
          </strong>
          <div class="small text-muted">
            {{ conv.last_message|default:conv.last_message_preview|truncatechars:80 }}
          </div>
        </div>

        <div class="text-end">
          <div class="small text-muted">{{ conv.updated_at|timesince }} atr√°s</div>
          {% if conv.unread_count %}
            <span class="badge bg-danger rounded-pill">{{ conv.unread_count }}</span>
          {% endif %}
        </div>
      </a>
    {% empty %}
      <div class="list-group-item">No hay conversaciones</div>
    {% endfor %}
  </div>
</div>
{% endblock %}