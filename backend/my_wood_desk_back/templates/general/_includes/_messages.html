{% if messages %}
  <div class="messages-container position-fixed top-0 end-0 p-3" style="z-index: 1100;">
    {% for message in messages %}
      {# Mapear tags a clases e iconos de Bootstrap sin usar {% set %} #}
      {% if 'error' in message.tags %}
        {% with level='danger' icon='bi-exclamation-triangle-fill' %}
          <div class="alert alert-{{ level }} alert-dismissible fade show shadow-sm mb-2" role="alert">
            <i class="bi {{ icon }} me-2"></i>
            <span class="message-text">{{ message }}</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endwith %}
      {% elif 'success' in message.tags %}
        {% with level='success' icon='bi-check-circle-fill' %}
          <div class="alert alert-{{ level }} alert-dismissible fade show shadow-sm mb-2" role="alert">
            <i class="bi {{ icon }} me-2"></i>
            <span class="message-text">{{ message }}</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endwith %}
      {% elif 'warning' in message.tags %}
        {% with level='warning' icon='bi-exclamation-circle-fill' %}
          <div class="alert alert-{{ level }} alert-dismissible fade show shadow-sm mb-2" role="alert">
            <i class="bi {{ icon }} me-2"></i>
            <span class="message-text">{{ message }}</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endwith %}
      {% else %}
        {% with level=message.tags|default:'info' icon='bi-info-circle-fill' %}
          <div class="alert alert-{{ level }} alert-dismissible fade show shadow-sm mb-2" role="alert">
            <i class="bi {{ icon }} me-2"></i>
            <span class="message-text">{{ message }}</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endwith %}
      {% endif %}
    {% endfor %}
  </div>

  <script>
    // Auto-hide alerts after 5s
    (function () {
      document.querySelectorAll('.messages-container .alert').forEach(function (el) {
        setTimeout(function () {
          if (!el.matches(':hover')) {
            var bsAlert = bootstrap.Alert.getOrCreateInstance(el);
            bsAlert.close();
          }
        }, 5000);
      });
    })();
  </script>
{% endif %}